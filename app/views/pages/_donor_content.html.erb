<div class="donor-section">
  <div class='container-fluid'>
    <!-- Header -->
    <div class='header'>
      <div class='header-text'>
        <h2>Welcome, <%= current_user.first_name %>!</h2>
        <p>Thank you for being a modern-day hero.</p>
      </div>

      <!-- Header cards -->
      <div class='header-cards'>
        <!-- Last donation card -->
        <%= link_to donations_path, class: 'text-decoration-none' do %>
          <div class='card header-card'>
            <div class='card-body'>
              <i class='fas fa-calendar-check me-2'></i>
              <h5 class='card-title'>Your Last Donation</h5>
              <% if @donor&.previous_donations? && @donor.last_donation.present? %>
                <div class='text-center'>
                  <p class='display-6 text-primary fw-bold mb-2'>
                    <%= @donor.last_donation.strftime('%b %d, %Y') %>
                  </p>
                  <p class='text-muted small'>
                    <%= time_ago_in_words(@donor.last_donation) %> ago
                  </p>
                  <p>click to view previous donations</p>
                </div>
              <% else %>
                <div class='text-center'>
                  <i class='fas fa-heart fa-2x text-muted mb-3'></i>
                  <p class="text-muted mb-2">No donations yet</p>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>

        <!-- Next eligible donation date -->
        <div class='card header-card'>
          <div class='card-body'>
            <i class='fas fa-calendar-alt me-2'></i>
            <h5 class='card-title'>Next Donation</h5>
            <div class='text-center'>
              <% if @donor&.previous_donations? %>
                <% if @donor.eligible_to_donate %>
                  <i class='fas fa-check-circle fa-2x text-success mb-2'></i>
                  <p class='h5 fw-bold text-success mb-1'>Ready to Donate</p>
                  <p class='small text-muted'>You can donate now</p>
                <% else %>
                  <p class='h4 text-primary fw-bold mb-1'>
                    <%= @donor.next_eligible_date.strftime('%b %d') %>
                  </p>
                  <p class='text-muted small'>
                    <%= @donor.next_eligible_date.strftime('%Y') %> • in <%= (@donor.next_eligible_date - Date.today).to_i %> days
                  </p>
                <% end %>
              <% else %>
                <i class='fas fa-star fa-2x text-muted mb-2'></i>
                <p class='h6 fw-bold text-muted'>First Time Donor</p>
                <p class='small text-muted'>You're eligible to start donating</p>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Stats cards -->
    <div class='cards-grid'>
      <!-- Urgent requests card -->
      <div class='card stats-card'>
        <% if @urgent_requests.any? %>
          <%= link_to urgent_requests_blood_requests_path, class: 'card-link' do %>
            <div class='card-body text-center'>
              <i class="fas fa-exclamation-triangle fa-3x text-danger mb-3"></i>
              <h3 class='text-danger mb-2'>Urgent Blood Requests</h3>
              <div class="urgent-count display-4 fw-bold text-danger mb-2">
                <%= @urgent_requests.count %>
              </div>
              <p class="text-muted mb-3">
                Your blood type needed: <%= BloodRequest.urgent_or_critical.active.where(blood_type: current_user.blood_type).count %>
              </p>
              <span class="btn btn-outline-danger btn-sm">View All Requests</span>
            </div>
          <% end %>
        <% else %>
          <div class='card-body text-center'>
            <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
            <h3 class="text-success mb-2">No Urgent Requests</h3>
            <p class="text-muted">All blood needs are currently met</p>
          </div>
        <% end %>
      </div>
      <!-- Accepted Blood Requests Card -->
      <div class='card stats-card'>
        <% accepted_count = @accepted_requests&.count || 0 %>
        <% if accepted_count > 0 %>
          <%= link_to accepted_requests_blood_requests_path, class: 'card-link' do %>
            <div class='card-body text-center'>
              <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
              <h3 class='text-success mb-2'>Accepted Blood Requests</h3>
              <div class="accepted-count display-4 fw-bold text-success mb-2">
                <%= accepted_count %>
              </div>
              <p class="text-muted mb-3">Requests you have accepted to donate</p>
              <span class="btn btn-outline-success btn-sm">View Accepted Requests</span>
            </div>
          <% end %>
        <% else %>
          <div class='card-body text-center'>
            <i class="fas fa-info-circle fa-3x text-muted mb-3"></i>
            <h3 class="text-muted mb-2">No Accepted Requests</h3>
            <p class="text-muted">You haven’t accepted any requests yet</p>
          </div>
        <% end %>
      </div>
    </div>
    <!-- Matching blood requests card -->
    <div class='card matching-request'>
      <% matching_count = BloodRequest.active.where(blood_type: current_user.blood_type).count %>
      <div class='card-body text-center'>
        <i class="fas fa-tint fa-3x text-danger mb-3"></i>
        <h3 class='text-danger'>Matching Your Blood Type</h3>
        <div class="matching-count display-4 fw-bold text-danger">
          <%= matching_count %>
        </div>
        <p class="text-muted">Requests matching <%= current_user.blood_type %></p>

        <div class="card-button-wrapper">
          <%= link_to donor_index_blood_requests_path, class: "btn btn-outline-danger btn-sm" do %>
            View Matching Requests
          <% end %>
        </div>
      </div>
    </div>

    <!-- Feature cards -->
    <div class='card feature-card'>
      <div class='card card-icon'>
        <i class="fas fa-hand-holding-medical"></i>
      </div>
      <div class='card-text text-center mb-2'>
        <h6><strong>All Blood Requests</strong></h6>
        <p>View all requests including urgent and matching ones.</p>
        <div class="text-center">
          <p class="h4 text-primary"><%= @blood_requests&.count || 0 %></p>
          <p class="small text-muted">Relevant Requests</p>
        </div>

        <!-- Button to redirect to blood requests index -->
        <%= link_to blood_requests_path, class: "btn btn-outline-danger btn-sm" do %>
          View All Requests
        <% end %>
      </div>
    </div>
    <!-- Map and Footer -->
    <%= render partial: 'shared/map' %>
    <div class='footer-card'>
      <div class='footer-content'>
        <div class='footer-text'>
          <h4>Your Donation Saves Lives</h4>
          <p>Every pint of blood can save up to three lives. Your contribution is a heroic act that makes a real difference in our community.</p>
        </div>
        <%# <%= image_tag 'human-blood-donate-white-background_1308-111266.avif', class: 'footer-image', alt: 'Blood donation' %>
      </div>
    </div>
  </div>
</div>
