<div class="donor-section">
  <div class='container-fluid'>
    <!-- Header -->
    <div class='header'>
      <div class='header-text'>
        <h2>Welcome, <%= current_user.first_name %>!</h2>
        <p>Thank you for being a modern-day hero.</p>
      </div>
    </div>
    <div class="cards-container">
      <%# Donation stats %>
      <!-- Last donation card -->
      <div class='card donation-stat'>
        <div class='card-body'>
          <div class='card-icon'>
            <i class='fas fa-calendar-check'></i>
          </div>
          <div class='card-icon-text'>
            <h5 class='card-title'>Last Donation</h5>
          </div>
        </div>
        <% if @donor.last_donation_date.present? %>
          <div class='text-center'>
            <p class='date'>
              <%= @donor.last_donation_date.strftime('%b %d, %Y') %>
            </p>
            <p class='text-muted small'>
              <%= time_ago_in_words(@donor.last_donation_date) %> ago
            </p>
            <%= link_to "View Donations", donations_path, class: "btn btn-outline-danger btn-sm" %>
          </div>
        <% else %>
          <div class='text-center'>
            <i class='fas fa-heart fa-2x text-muted'></i>
            <p class="text">No donations yet</p>
            <%= link_to "Start Donating", donations_path, class: "start-donating-btn" %>
          </div>
        <% end %>
      </div>

      <!-- Next eligible donation date -->
      <div class='card donation-stat'>
        <div class='card-body'>
          <div class ='card-icon'>
            <i class='fas fa-calendar-alt'></i>
          </div>
          <div class='card-icon-text'>
            <h5 class='card-title'>Next Donation</h5>
          </div>
        </div>
        <div class='text-center'>
          <% if @donor&.previous_donations? %>
            <% if @donor.eligible_to_donate %>
              <i class='fas fa-check-circle fa-2x text-success'></i>
              <p class='h5 fw-bold text-success'>Ready to Donate</p>
              <%# <p class='small text'>You can donate now</p> %>
            <% else %>
              <p class='date'>
                <%= @donor.next_eligible_date.strftime('%b %d') %>
              </p>
              <p class='text-muted small'>
                <%= @donor.next_eligible_date.strftime('%Y') %> â€¢ in <%= (@donor.next_eligible_date - Date.today).to_i %> days
              </p>
            <% end %>
          <% else %>
            <i class='fas fa-star fa-2x text-muted'></i>
            <p class='h6 fw-bold text'>First Time Donor</p>
            <p class='small text'>You're eligible to start donating</p>
          <% end %>
        </div>
      </div>
      <!-- Urgent requests card -->
      <div class='card blood-request-card'>
        <% if @urgent_requests.any? %>
          <div class='card-body'>
            <div class='card-icon'>
              <i class="fas fa-exclamation-triangle fa-2x"></i>
            </div>
            <div class='card-icon-text'>
              <h5 class='text-danger'>Urgent Blood Requests</h5>
            </div>
          </div>
          <div class="urgent-count">
            <%= @urgent_requests.count %>
          </div>
          <p class="text count">
            Your blood type needed: <%= BloodRequest.urgent_or_critical.active.where(blood_type: current_user.blood_type).count %>
          </p>
          <%= link_to "View Urgent Requests", urgent_requests_blood_requests_path, class: "btn btn-outline-danger btn-sm urgent" %>
        <% else %>
          <div class='card-body text-center'>
            <i class="fas fa-check-circle fa-3x text-success"></i>
            <h5 class="text-success">No Urgent Requests</h5>
            <p class="text">All blood needs are currently met</p>
          </div>
        <% end %>
      </div>
      <!-- Matching blood requests card -->
      <div class='card blood-request-card'>
        <div class="matching-count">
          <% matching_count = BloodRequest.active.where(blood_type: current_user.blood_type).count %>
        </div>
        <div class='card-body'>
          <div class ='card-icon'>
            <i class="fas fa-tint fa-2x"></i>
          </div>
          <div class='card-icon-text'>
            <h5 class='text-danger'>Matching Your Blood Type</h5>
          </div>
        </div>
        <div class="matching-count fw-bold text-danger">
          <%= matching_count %>
        </div>
        <p class="text count mb-o">Requests matching <%= current_user.blood_type %></p>

        <div class="card-button-wrapper mt-o">
          <%= link_to donor_index_blood_requests_path, class: "btn btn-outline-danger btn-sm" do %>
            View Matching Requests
          <% end %>
        </div>
      </div>
      <%# All blood request card  %>
      <div class='card blood-request-card'>
        <div class='card-body'>
          <div class ='card-icon'>
            <i class="fas fa-hand-holding-medical fa-2x"></i>
          </div>
          <div class='card-icon-text'>
            <h5><strong>All Blood Requests</strong></h5>
          </div>
        </div>
        <div class='card-text text-center'>
            <p class="urgent-count"><%= @blood_requests&.count || 0 %></p>
          <p class="view-all">Pending Blood Request</p>
          <!-- Button to redirect to blood requests index -->
          <%= link_to blood_requests_path, class: "btn btn-outline-danger btn-sm" do %>
            View All Requests
          <% end %>
        </div>
      </div>
      <!-- Accepted Blood Requests Card -->
      <div class='card accepted-request' id="accepted-card">
        <% accepted_count = @accepted_requests&.count || 0 %>
        <% if accepted_count > 0 %>
          <div class='card-body'>
            <div class='card-icon '>
              <i class="fas fa-check-circle fa-3x text-success"></i>
            </div>
            <div class='card-icon-text'>
              <h5 class='text-success mb-2'>Accepted Blood Requests</h5>
            </div>
          </div>
          <div class="accepted-count fw-bold text-success">
            <%= accepted_count %>
          </div>
          <p class="text mb-2">Requests you have accepted to donate</p>

          <div class="card-button-wrapper">
            <%= link_to "View Accepted Requests", accepted_requests_blood_requests_path, class: "btn btn-outline-success btn-sm" %>
          </div>
        <% else %>
          <div class='card-body'>
            <div class='card-icon'>
              <i class="fas fa-info-circle fa-3x"></i>
            </div>
            <div class='card-icon-text'>
              <h5 class="text">No Accepted Requests</h5>
            </div>
          </div>
            <p class="text">You haven't accepted any requests yet</p>
        <% end %>
      </div>
    </div>
  </div>
    <!-- Map and Footer -->
    <%= render partial: 'shared/map' %>
  <div class='footer-card'>
    <div class='footer-content'>
      <div class='footer-text'>
        <h4>Your Donation Saves Lives</h4>
        <p>Every pint of blood can save up to three lives. Your contribution is a heroic act that makes a real difference in our community.</p>
      </div>
      <%# <%= image_tag 'human-blood-donate-white-background_1308-111266.avif', class: 'footer-image', alt: 'Blood donation' %>
    </div>
  </div>
</div>
