<div class="container mt-1" style="max-width:420px; padding-top:0; margin-top:0;">

  <!-- Page Header -->
  <div class="d-flex align-items-center pt-4 mb-3">

    <!-- Left: Back arrow → HOME -->
    <div style="width: 40px;">
      <button type="button"
              onclick="window.location.href='<%= root_path %>'"
              class="p-0 border-0 bg-transparent text-dark fs-4"
              style="outline:none;">
        <i class="bi bi-arrow-left"></i>
      </button>
    </div>

    <!-- Center: Title -->
    <div class="flex-grow-1 text-center">
      <h4 class="fw-bold mb-0">
        <% if current_user.donor? %>
          Blood Requests
        <% elsif params[:filter] == "active" %>
          My Active Requests
        <% elsif params[:filter] == "completed" %>
          Previous Requests
        <% else %>
          My Blood Requests
        <% end %>
      </h4>
    </div>

    <!-- Right spacer -->
    <div style="width: 40px;"></div>

  </div>


  <% if @blood_requests.empty? %>
    <div class="text-center py-5">
      <div class="mb-4">
        <i class="bi bi-inbox" style="font-size: 3rem; color: #6c757d;"></i>
      </div>
      <h5 class="text-muted mb-2">
        <% if current_user.donor? %>
          No Blood Requests Available
        <% elsif params[:filter] == "active" %>
          No Active Requests
        <% elsif params[:filter] == "completed" %>
          No Previous Requests
        <% else %>
          No Blood Requests
        <% end %>
      </h5>
      <p class="text-muted small mb-0">
        <% if current_user.donor? %>
          There are currently no pending blood requests.
        <% elsif params[:filter] == "active" %>
          You don't have any active blood requests.
        <% elsif params[:filter] == "completed" %>
          You haven't completed any requests yet.
        <% else %>
          You don't have any pending blood requests at the moment.
        <% end %>
      </p>
    </div>
  <% else %>
    <% @blood_requests.each do |r| %>

      <%= link_to blood_request_path(r), class:"text-decoration-none", style:"color:inherit;" do %>

        <% status_label = {
          "pending" => "Pending",
          "accepted" => "Accepted",
          "completed" => "Completed"
        }[r.status] %>

        <% status_color = {
          "pending" => "#EC1B35",
          "accepted" => "#e951cb",
          "completed" => "#22C55E"
        }[r.status] %>

        <div class="card border-0 shadow-sm mb-4"
             style="background:#FFF1F2; border-radius:18px; max-width:360px; margin:0 auto; cursor:pointer;">

          <div class="card-body p-3">

            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="small fw-semibold" style="color:#EC1B35;">
                Request #<%= r.id %>
              </span>

              <span class="badge rounded-pill px-3 py-1"
                    style="background:<%= status_color %>; color:white;">
                <%= status_label %>
              </span>
            </div>

            <div class="blood-row-grid mb-2">

              <div class="blood-type-box">
                <%= r.blood_type %>
              </div>

              <div class="blood-row-right">

                <div class="facility-name">
                  <%= r.facility&.name %>
                </div>

                <% urgency_label = {
                  "normal"=>"Normal",
                  "urgent"=>"Urgent",
                  "critical"=>"Critical"
                }[r.urgency] %>

                <% urgency_color = {
                  "normal"=>"#3B82F6",
                  "urgent"=>"#F59E0B",
                  "critical"=>"#DC2626"
                }[r.urgency] %>

                <div class="urgency-row" style="color:<%= urgency_color %>;">
                  ⚠️ <%= urgency_label %>
                </div>

                <div class="needed-row">
                  Needed by: <%= r.needed_by.strftime('%d %b %Y') %>
                </div>

              </div>
            </div>

            <div class="info-row">

              <span>
                <i class="bi bi-droplet-half"></i>
                <strong><%= r.quantity %></strong> bags
              </span>

              <span class="mx-1"></span>

              <span>
                <i class="bi bi-telephone-fill"></i>
                <%= r.patient_phone_number %>
              </span>

              <span class="mx-1"></span>

              <span>
                <i class="bi bi-person-fill"></i>
                <%= r.patient_name %>
              </span>

            </div>

          </div>
        </div>

      <% end %>

    <% end %>

  <% end %>

</div>
